<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Proyecto clase IA â€“ OrientaciÃ³n vocacional (FP CV)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#eef4ff;
      --card:#ffffff;
      --primary:#2f6fed;
      --primary-dark:#1e55c9;
      --line:#dbe7ff;
      --text:#0b1a33;
      --muted:#4b5a77;
      --radius:16px;
      --shadow:0 10px 26px rgba(30,70,160,.12);
      --chip:#eff5ff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:linear-gradient(180deg,#f4f8ff,#eaf1ff);
      color:var(--text);
    }
    .wrap{
      max-width:1000px;
      margin:auto;
      padding:28px;
    }
    h1{margin:0 0 6px;font-size:30px;color:var(--primary-dark)}
    h2{margin:0 0 12px;font-size:22px;color:var(--primary)}
    p.desc{margin:0 0 22px;color:var(--muted)}
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
      margin-bottom:20px;
    }
    .question{
      margin-bottom:18px;
      padding:16px;
      border:1px solid var(--line);
      border-radius:14px;
      background:#f9fbff;
    }
    .question h3{margin:0 0 10px;font-size:16px}
    .options{display:flex;flex-wrap:wrap;gap:14px}
    label.option{
      display:flex;align-items:center;gap:8px;
      background:#fff;padding:8px 12px;border-radius:10px;border:1px solid var(--line);
      cursor:pointer;
    }
    input[type="text"], input[type="number"], textarea{
      width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--line);
      font-size:14px;outline:none;
    }
    textarea{resize:vertical}
    .btn{
      background:var(--primary);color:#fff;border:0;border-radius:14px;
      padding:14px 24px;font-size:16px;font-weight:700;cursor:pointer;
    }
    .btn:hover{background:var(--primary-dark)}
    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:14px;
    }
    @media (max-width: 920px){
      .grid{grid-template-columns: 1fr;}
    }
    .rec{
      border:1px solid var(--line);
      border-radius:14px;
      padding:16px;
      background:#fbfdff;
    }
    .rec h3{
      margin:0 0 8px;
      font-size:16px;
      color:var(--primary-dark);
    }
    .meta{
      display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px;
    }
    .chip{
      background:var(--chip);
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      font-weight:600;
    }
    .motivo{
      margin:0;
      color:#22304a;
      line-height:1.35;
      font-size:14px;
    }
    .score{
      margin-top:10px;
      font-weight:800;
      color:var(--primary-dark);
    }
    pre{
      background:#0b1a33;color:#e6eeff;
      padding:18px;border-radius:14px;overflow:auto;max-height:420px;font-size:14px;
    }
    footer{text-align:center;color:var(--muted);margin-top:30px;font-size:13px}
  </style>
</head>

<body>
<div class="wrap">

  <div class="card">
    <h1>Proyecto clase IA</h1>
    <p class="desc">
      El formulario envÃ­a las respuestas al backend y obtiene <b>3 ciclos de FP de la Comunidad Valenciana</b>.
      VerÃ¡s el JSON y el TOP 3 en formato bonito.
    </p>
  </div>

  <form id="form">

    <div class="card">
      <h2>1. Datos generales</h2>

      <div class="question">
        <h3>Edad</h3>
        <input type="number" name="edad" min="10" max="100" required>
      </div>

      <div class="question">
        <h3>Nivel educativo actual</h3>
        <div class="options">
          <label class="option"><input type="radio" name="nivel" value="Secundaria incompleta" required> Secundaria incompleta</label>
          <label class="option"><input type="radio" name="nivel" value="Secundaria completa"> Secundaria completa</label>
          <label class="option"><input type="radio" name="nivel" value="Terciario/Universidad en curso"> Terciario / Universidad en curso</label>
          <label class="option"><input type="radio" name="nivel" value="Terciario/Universidad completa"> Terciario / Universidad completa</label>
        </div>
      </div>

      <div class="question">
        <h3>PaÃ­s / regiÃ³n</h3>
        <input type="text" name="region" required>
      </div>

      <div class="question">
        <h3>Â¿Estudias actualmente?</h3>
        <div class="options">
          <label class="option"><input type="radio" name="estudia" value="SÃ­" required> SÃ­</label>
          <label class="option"><input type="radio" name="estudia" value="No"> No</label>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>2. Intereses principales</h2>

      <div class="question">
        <h3>Â¿QuÃ© actividades disfrutas mÃ¡s? (mÃ¡x. 3)</h3>
        <div class="options">
          <label class="option"><input type="checkbox" name="actividades" value="Resolver problemas / lÃ³gica"> Resolver problemas / lÃ³gica</label>
          <label class="option"><input type="checkbox" name="actividades" value="Crear cosas"> Crear cosas</label>
          <label class="option"><input type="checkbox" name="actividades" value="Ayudar a personas"> Ayudar a personas</label>
          <label class="option"><input type="checkbox" name="actividades" value="Investigar / aprender"> Investigar / aprender</label>
          <label class="option"><input type="checkbox" name="actividades" value="TecnologÃ­a"> Trabajar con tecnologÃ­a</label>
          <label class="option"><input type="checkbox" name="actividades" value="Actividad fÃ­sica / manual"> Actividad fÃ­sica / manual</label>
          <label class="option"><input type="checkbox" name="actividades" value="Liderar / organizar"> Liderar / organizar</label>
          <label class="option"><input type="checkbox" name="actividades" value="Vender / negociar"> Vender / negociar</label>
        </div>
      </div>

      <div class="question">
        <h3>Â¿QuÃ© temas te interesan mÃ¡s?</h3>
        <textarea name="temas_interes" rows="3"></textarea>
      </div>
    </div>

    <div class="card">
      <h2>3. Habilidades percibidas</h2>

      <div class="question">
        <h3>Â¿En quÃ© sientes que eres bueno/a?</h3>
        <textarea name="habilidades" rows="3"></textarea>
      </div>

      <div class="question">
        <h3>Â¿QuÃ© tipo de tareas prefieres?</h3>
        <div class="options">
          <label class="option"><input type="checkbox" name="tareas" value="PrÃ¡cticas"> PrÃ¡cticas</label>
          <label class="option"><input type="checkbox" name="tareas" value="TeÃ³ricas"> TeÃ³ricas</label>
          <label class="option"><input type="checkbox" name="tareas" value="Creativas"> Creativas</label>
          <label class="option"><input type="checkbox" name="tareas" value="AnalÃ­ticas"> AnalÃ­ticas</label>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>4. Personalidad y estilo de trabajo</h2>

      <div class="question">
        <h3>Â¿Prefieres trabajarâ€¦?</h3>
        <div class="options">
          <label class="option"><input type="radio" name="trabajo" value="Solo" required> Solo/a</label>
          <label class="option"><input type="radio" name="trabajo" value="Equipo"> En equipo</label>
          <label class="option"><input type="radio" name="trabajo" value="Indistinto"> Indistinto</label>
        </div>
      </div>

      <div class="question">
        <h3>Â¿CÃ³mo te sientes frente a los desafÃ­os?</h3>
        <div class="options">
          <label class="option"><input type="radio" name="desafios" value="Me motivan" required> Me motivan</label>
          <label class="option"><input type="radio" name="desafios" value="Me generan ansiedad"> Me generan ansiedad</label>
          <label class="option"><input type="radio" name="desafios" value="Depende"> Depende de la situaciÃ³n</label>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>5. Valores y expectativas laborales</h2>

      <div class="question">
        <h3>Â¿QuÃ© valoras mÃ¡s en un trabajo? (mÃ¡x. 2)</h3>
        <div class="options">
          <label class="option"><input type="checkbox" name="valores" value="Buen salario"> Buen salario</label>
          <label class="option"><input type="checkbox" name="valores" value="Estabilidad"> Estabilidad</label>
          <label class="option"><input type="checkbox" name="valores" value="Impacto social"> Impacto social</label>
          <label class="option"><input type="checkbox" name="valores" value="Creatividad"> Creatividad</label>
          <label class="option"><input type="checkbox" name="valores" value="Crecimiento profesional"> Crecimiento profesional</label>
          <label class="option"><input type="checkbox" name="valores" value="Flexibilidad"> Flexibilidad</label>
        </div>
      </div>

      <div class="question">
        <h3>Â¿CÃ³mo serÃ­a tu dÃ­a laboral ideal?</h3>
        <textarea name="dia_ideal" rows="3"></textarea>
      </div>
    </div>

    <div class="card">
      <button class="btn" type="submit">Obtener 3 ciclos recomendados</button>
    </div>
  </form>

  <div class="card">
    <h2>TOP 3 recomendaciones</h2>
    <div id="cards" class="grid">
      <div class="rec">Rellena el formulario y pulsa el botÃ³n ðŸ™‚</div>
    </div>
  </div>

  <div class="card">
    <h2>JSON devuelto por la IA</h2>
    <pre id="output">{ }</pre>
  </div>

  <footer>
    Proyecto clase IA Â· Resultado final: 3 ciclos FP Comunidad Valenciana âœ…
  </footer>

</div>

<script>
function formToJSON(form) {
  const fd = new FormData(form);
  const data = {};
  for (const [k, v] of fd.entries()) {
    if (data[k] !== undefined) {
      if (!Array.isArray(data[k])) data[k] = [data[k]];
      data[k].push(v);
    } else {
      data[k] = v;
    }
  }
  return data;
}

function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function renderTop3(recs){
  const cards = document.getElementById("cards");
  if (!Array.isArray(recs) || recs.length === 0){
    cards.innerHTML = `<div class="rec">No se recibieron recomendaciones.</div>`;
    return;
  }

  cards.innerHTML = recs.slice(0,3).map((r, idx) => {
    const ciclo = escapeHtml(r.ciclo);
    const grado = escapeHtml(r.grado);
    const familia = escapeHtml(r.familia_profesional);
    const motivo = escapeHtml(r.motivo);
    const encaje = Number.isFinite(r.encaje) ? r.encaje : parseInt(r.encaje || "0", 10) || 0;

    return `
      <div class="rec">
        <h3>${idx+1}. ${ciclo}</h3>
        <div class="meta">
          <span class="chip">${grado}</span>
          <span class="chip">${familia}</span>
        </div>
        <p class="motivo">${motivo}</p>
        <div class="score">Encaje: ${encaje}/100</div>
      </div>
    `;
  }).join("");
}

document.getElementById("form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const out = document.getElementById("output");
  out.textContent = "Consultando a la IA (Nova Pro)...";

  const payload = formToJSON(e.target);

  if (Array.isArray(payload.actividades) && payload.actividades.length > 3) {
    out.textContent = "Error: selecciona como mÃ¡ximo 3 actividades.";
    return;
  }
  if (Array.isArray(payload.valores) && payload.valores.length > 2) {
    out.textContent = "Error: selecciona como mÃ¡ximo 2 valores.";
    return;
  }

  try {
    const res = await fetch("http://127.0.0.1:8000/api/orientacion", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(payload)
    });

    const json = await res.json();
    out.textContent = JSON.stringify(json, null, 2);

    if (json.ok && json.data && Array.isArray(json.data.recomendaciones)) {
      renderTop3(json.data.recomendaciones);
    } else {
      renderTop3([]);
    }

  } catch (err) {
    out.textContent = "Error al conectar con el backend: " + err;
    renderTop3([]);
  }
});
</script>

</body>
</html>
